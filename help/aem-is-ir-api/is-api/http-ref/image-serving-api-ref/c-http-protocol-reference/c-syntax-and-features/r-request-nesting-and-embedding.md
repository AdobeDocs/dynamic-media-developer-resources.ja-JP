---
description: 画像サービングでは、画像サービング要求の無制限のネスト、画像レンダリング要求の埋め込み、および外部サーバから取得した画像の埋め込みをサポートしています。 これらのメカニズムは、レイヤー画像とレイヤーマスクのみでサポートされます。
seo-description: 画像サービングでは、画像サービング要求の無制限のネスト、画像レンダリング要求の埋め込み、および外部サーバから取得した画像の埋め込みをサポートしています。 これらのメカニズムは、レイヤー画像とレイヤーマスクのみでサポートされます。
seo-title: リクエストのネストと埋め込み
solution: Experience Manager
title: リクエストのネストと埋め込み
topic: Scene7 Image Serving - Image Rendering API
uuid: 59031329-e65f-4631-bc7d-83f2540cc836
translation-type: tm+mt
source-git-commit: 7bc7b3a86fbcdc57cfdc31745fae3afc06e44b15

---


# リクエストのネストと埋め込み{#request-nesting-and-embedding}

画像サービングでは、画像サービング要求の無制限のネスト、画像レンダリング要求の埋め込み、および外部サーバから取得した画像の埋め込みをサポートしています。 これらのメカニズムは、レイヤー画像とレイヤーマスクのみでサポートされます。

>[!NOTE] {class=&quot;- topic/note &quot;}
>
>一部の電子メールクライアントおよびプロキシサーバーでは、ネストと埋め込みの構文に使用する波括弧がエンコードされる場合があります。 この問題が発生するアプリケーションでは、波括弧の代わりに括弧を使用する必要があります。

## ネストされた画像サービング要求 {#section-6954202119e0466f8ff27c79f4f039c8}

次の構文を使用して、（または）コマンドで指定することで、画像サービング要求全体をレ `src=` イヤーソ `mask=`ースとして使用できます。

`…&src=is( nestedRequest)&…`

トークン `is` では大文字と小文字が区別されます。

ネストされた要求には、サーバーのルートパス(通常は ` http:// *[!DNL server]*/is/image/'`)を含めないでください。

>[!NOTE] {class=&quot;- topic/note &quot;}
>
>ネストされたリクエスト区切り文 `'(',')'`字()と、ネストされたリクエスト内のコマ `'?'`ンド区切り文字(, `'&'`, `'='`)は、HTTPエンコードしてはなりません。 ネストされたリクエストは、外側の（ネストされた）リクエストと同じエンコードが必要です。

前処理ルールは、ネストされたリクエストに適用されます。

ネストされたリクエスト（リクエストURLまたはまたは内）で指定した場合、次のコマンドは無 `catalog::Modifier` 視され `catalog::PostModifier`ます。

* `fmt=`
* `qlt=`
* `iccEmbed=`
* `printRes=`
* `quantize=`
* `req=`
* `bgc=`

ネストされた要求の結果の画像にマスク（アルファ）データが含まれている場合、その画像はレイヤーマスクとして埋め込みレイヤーに渡されます。

また、ネストされ `attribute::MaxPix`た要求 `attribute::DefaultPix` に適用される画像カタログのも無視されます。

ネストされたIS要求のイメージ結果は、を含めることで、オプションでキャッシュできま `cache=on`す。 デフォルトでは、中間データのキャッシュは無効になっています。 キャッシュは、中間イメージが別の要求で適切な期間内に再利用されると予想される場合にのみ有効にする必要があります。 標準のサーバー側キャッシュ管理が適用されます。 データは可逆圧縮形式でキャッシュされます。

## 埋め込み画像レンダリング要求 {#section-69c5548db930412b9b90d9b2951a6969}

サーバでScene7の画像レンダリングが有効な場合、src=（またはmask=）コマンドでレンダリング要求を指定することで、レイヤーソースとしてレンダリング要求を使用できます。 次の構文を使用します。

` …&src=ir( *[!DNL renderRequest]*)&…`

トークン `ir` では大文字と小文字が区別されます。

*[!DNL renderRequest]* は、通常のイメージレンダリング要求で、HTTPルートパスは除きま ` http:// *[!DNL server]*/ir/render/`す。

>[!NOTE] {class=&quot;- topic/note &quot;}
>
>ネストされたリクエスト区切り文 `'(',')'`字()と、ネストされたリクエスト内のコマ `'?'`ンド区切り文字(, `'&'`, `'='`)は、HTTPエンコードしてはなりません。 実際には、埋め込まれたリクエストは、外側の（埋め込み）リクエストと同じエンコードが必要です。

ネストされた要求で指定した場合、次の画像レンダリングコマンドは無視されます。

* `fmt=`
* `qlt=`
* `icc=`
* `iccEmbed=`
* `printRes=`
* `req=`

また、ネストされたレ `attribute::MaxPix` ンダリング `attribute::DefaultPix` 要求に適用されるマテリアルカタログのも無視されます。

入れ子になったIR要求のイメージ結果は、を含めることで、オプションでキャッシュできま `cache=on`す。 デフォルトでは、中間データのキャッシュは無効になっています。 キャッシュは、中間イメージが別の要求で適切な期間内に再利用されると予想される場合にのみ有効にする必要があります。 標準のサーバー側キャッシュ管理が適用されます。 データは可逆圧縮形式でキャッシュされます。

## 埋め込みFXGレンダリング要求 {#section-c817e4b4f7da414ea5a51252ca7e120a}

FXGグラフィックスレンダラ（別名）がインストールされ、画像サービングで有効になっている場合、FXG要求は、（または）コマンドで指定することで、レイヤーソースと [!DNL AGMServer]して使用 `src=``mask=`できます。 次の構文を使用します。

`…&src=fxg( renderRequest)&…`

トークン `fxg` では大文字と小文字が区別されます。

>[!NOTE] {class=&quot;- topic/note &quot;}
>
>FXGグラフィックレンダリングは、Scene7のホスト環境でのみ使用でき、追加のライセンスが必要な場合があります。 詳しくは、Scene7サポートにお問い合わせください。

*[!DNL renderRequest]* は、通常のFXGレンダリング要求で、HTTPルートパスは除きま ` http:// *[!DNL server]*/agm/render/`す。

>[!NOTE] {class=&quot;- topic/note &quot;}
>
>ネストされたリクエスト内 `'(',')'`の区切り文字()とコマ `'?'`ンド区切り文字(, `'&'`, `'='`)は、HTTPエンコードしないでください。 実際には、埋め込まれたリクエストは、外側の（埋め込み）リクエストと同じエンコードが必要です。

ネストされた要求で指定した場合、次のFXGコマンドは無視されます。

* `fmt=`
* `qlt=`
* `icc=`
* `iccEmbed=`
* `cache=`

## 外部画像ソース {#section-84e83ecfcd1a43748cdfc7a6f8c04cb8}

画像サービングは、外部HTTPサーバ上のソース画像へのアクセスをサポートします。

>[!NOTE]
>
>リモートURLに対しては、HTTPプロトコルのみがサポートされます。

またはコマンドの外部URLを指定す `src=` るには、 `mask=` 次のように外部URLまたはURLフラグメントを丸括弧で囲みます。

`…&src=( foreignUrl)&…`

重要：ネストされたリクエ `'(',')'`スト内の区切り文字( `'?'`)とコマンド区切り文字( `'&'`, `'='`,)は、HTTPエンコードしてはなりません。 実際には、埋め込まれたリクエストは、外側の（埋め込み）リクエストと同じエンコードが必要です。

完全な絶対URL(設定さ `attribute::AllowDirectUrls` れている場合)およびを基準とした相対URLが許可 `attribute::RootUrl` されます。 絶対URLが埋め込まれ、属性が次の場合にエラーが発生します。が0 `AllowDirectUrls` の場合、または相対URLが指定されていて空の場 `attribute::RootUrl` 合。

リクエストURLのパスコンポーネントに外部URLを直接指定することはできませんが、相対パスから絶対URLへの変換を許可する前処理ルールを設定することができます（以下の例を参照）。

外部画像は、HTTP応答に含まれるキャッシュヘッダーに従って、サーバーによってキャッシュされます。 HTTP応答ヘッダーも最 `ETag` 終変更時のHTTP応答ヘッダーも存在しない場合、応答はキャッシュされません。 これにより、同じ外部画像に対する繰り返しアクセスのパフォーマンスが低下する可能性があります。画像サービングでは、アクセスのたびに画像を再取得して再検証する必要があります。

このメカニズムは、コンポーネントあたり16ビットのソースイメージを除き、イメージ変換(IC)ユーティリティでサポートされるのと同じイメージファイル形式をサポートします。

>[!NOTE] {class=&quot;- topic/note &quot;}
>
>画像サービングは、外部画像が最初に使用されたときに検証ユーティリティを自動的に実行し、画像が有効で、送信中に破損していないことを確認します。 これにより、最初のアクセスで若干遅延が発生する場合があります。 最高のパフォーマンスを得るには、そのような画像のサイズを制限したり、圧縮率の高い画像ファイル形式を使用したりすることをお勧めします。

## Restrictions {#section-fb68e3f0d40947feb94d7bf183b64929}

ネストされた/埋め込まれた要求で生成される画像のサイズは、通常、自動的に最適化されます。 ネストされた要求イメージのキャッシュが有効な場合は、ネストされたイメージの正確なサイズを指定することでパフォーマンスの向上を図ることができ、キャッシュエントリを再利用する際に、それ以上の拡大を必要としません。

重要な画像サービングは、ネストされた要求や埋め込まれた要求の二重エンコードをサポートしていません。 ネストされたリクエストと埋め込まれたリクエストは、単純なリクエストと同様にHTTPエンコードする必要があります。

## 例 {#section-d800cfc31abe46d2a964f8e7929231f1}

**キャッシュを使用したテンプレートのレイヤー化：**

ネストを使用して、レイヤーテンプレートにキャッシュを追加します。 限られた数の背景画像が、高可変テキストで重ねて表示されます。 最初のテンプレート文字列は次のようになります。

`layer=0&src=$img$&size=300,300&layer=1&text=$txt$`

わずかな変更を加えることで、レイヤ0の画像を事前にスケールし、持続的にキャッシュすることが可能になり、サーバの負荷を軽減できます。

`layer=0&src=is(?src=$img$&size=300,300&cache=on)&layer=1&text=$txt$`

**Scene7画像レンダリングの要求の埋め込み**

に保存されたテンプレートの使 [!DNL myCatalog/myTemplate]用；scene7画像レンダリングを使用して、テンプレートのlayer2の画像を生成します。

`http://server/is/image/myCatalog/myTemplate?layer=2&src=ir(myRenderCatalog/myRenderObject?id=myIdValue&sel=group&src=is(myCatalog/myTexture1?res=30)&res=30)&wid=300`

入れ子の中括弧。 画像レンダリング要求は、繰り返し可能なテクスチャを取得するために、画像サービングへのコールバックを埋め込みます。

## 関連項目 {#section-109a0a9a3b144158958351139c8b8e69}

[src=](../../../../../is-api/http-ref/image-serving-api-ref/c-http-protocol-reference/c-command-reference/r-src.md#reference-f6506637778c4c69bf106a7924a91ab1) , [mask=](../../../../../is-api/http-ref/image-serving-api-ref/c-http-protocol-reference/c-command-reference/r-mask.md#reference-922254e027404fb890b850e2723ee06e), Request PreProcessing [, Image Rendering Reference, Templates](../../../../../is-api/http-ref/image-serving-api-ref/c-http-protocol-reference/c-syntax-and-features/r-request-preprocessing.md#reference-c27976436bf04194bfbe9adf40ea98e3), [](../../../../../is-api/http-ref/image-serving-api-ref/c-http-protocol-reference/c-templates/c-templates.md#concept-3cd2d2adae0e41b2979b9640244d4d3e)[Image Serving Utilities](../../../../../is-api/is-utils/utilities/c-location-of-utilities.md#concept-bae61e53344449af978502cac6be8b5f)
